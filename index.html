<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Shield | AI è§†é¢‘æƒ…æŠ¥ç«™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">
    <nav class="border-b border-slate-800 p-4 sticky top-0 z-50 glass">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
                ğŸ¬ Echo Shield Dashboard
            </h1>
            <div id="status-dot" class="flex items-center text-sm text-slate-400">
                <span class="w-2 h-2 bg-emerald-500 rounded-full mr-2 animate-pulse"></span> ç³»ç»Ÿå®æ—¶ç›‘æ§ä¸­
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6 flex flex-col lg:flex-row gap-8">
        <div class="lg:w-3/4">
            <h2 class="text-xl font-semibold mb-6 flex items-center">
                <span class="mr-2">ğŸ”¥</span> æœ€æ–°é‡‡é›†æƒ…æŠ¥
            </h2>
            <div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <div class="animate-pulse bg-slate-800 h-64 rounded-xl"></div>
                <div class="animate-pulse bg-slate-800 h-64 rounded-xl"></div>
                <div class="animate-pulse bg-slate-800 h-64 rounded-xl"></div>
            </div>
        </div>

        <div class="lg:w-1/4">
            <div class="sticky top-24">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <span class="mr-2">ğŸ†</span> AI æ·±åº¦åˆ†ææ¦œ
                </h2>
                <div id="rank-list" class="glass rounded-2xl p-4 space-y-4 custom-scrollbar max-h-[80vh] overflow-y-auto">
                    <p class="text-slate-500 text-center py-10">æ­£åœ¨è¯„ä¼°å†…å®¹è´¨é‡...</p>
                </div>
                <p class="text-xs text-slate-500 mt-4 px-2">
                    * è¯„åˆ†åŸºäºè§†é¢‘å…ƒæ•°æ®ä¸ AI å†…å®¹è¯†åˆ«é€»è¾‘
                </p>
            </div>
        </div>
    </main>

    <script>
        async function updateDashboard() {
            try {
                // 1. è·å–æ•°æ®
                const response = await fetch('http://127.0.0.1:8000/videos/latest');
                const videos = await response.json();
                
                const grid = document.getElementById('video-grid');
                const rankList = document.getElementById('rank-list');
                
                if (videos.length === 0) {
                    grid.innerHTML = "<div class='col-span-full py-20 text-center text-slate-500'>æ•°æ®åº“æš‚æ— è§†é¢‘ï¼Œè¯·ç­‰å¾…çˆ¬è™«è¿è¡Œ...</div>";
                    return;
                }

                // --- é€»è¾‘ï¼šå¤„ç†ä¸»è§†é¢‘æµ ---
                grid.innerHTML = '';
                videos.forEach(v => {
                    const imgUrl = v.thumb.replace('s3://echo-shield/', 'http://localhost:9000/echo-shield/');
                    grid.innerHTML += `
                        <div class="card glass rounded-xl overflow-hidden group hover:border-blue-500/50 transition-all duration-300">
                            <div class="relative">
                                <img src="${imgUrl}" class="w-full h-40 object-cover" onerror="this.src='https://via.placeholder.com/400x225/1e293b/fff?text=No+Image'">
                                <span class="absolute top-2 right-2 bg-slate-900/80 px-2 py-1 rounded text-xs">
                                    ${v.views ? (v.views/1000).toFixed(1)+'k' : '0'} views
                                </span>
                            </div>
                            <div class="p-4">
                                <h3 class="font-medium text-sm line-clamp-2 mb-3 h-10 group-hover:text-blue-400 transition-colors">${v.title}</h3>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-xs text-slate-400">${v.author}</span>
                                    <div class="flex items-center">
                                        <span class="text-[10px] text-slate-500 mr-1">AI Score:</span>
                                        <span class="text-xs font-bold text-emerald-400">${v.ai_meta_score.toFixed(2)}</span>
                                    </div>
                                </div>
                                <a href="${v.url}" target="_blank" class="block text-center mt-4 py-2 bg-slate-800 hover:bg-blue-600 rounded-lg text-xs font-semibold transition-colors">æŸ¥çœ‹è¯¦æƒ…</a>
                            </div>
                        </div>
                    `;
                });

                // --- é€»è¾‘ï¼šå¤„ç†ä¾§è¾¹æ’è¡Œæ¦œ (æŒ‰ AI è¯„åˆ†æ’åº) ---
                const sortedVideos = [...videos].sort((a, b) => b.ai_meta_score - a.ai_meta_score).slice(0, 10);
                rankList.innerHTML = '';
                sortedVideos.forEach((v, index) => {
                    rankList.innerHTML += `
                        <a href="${v.url}" target="_blank" class="flex items-start gap-3 p-2 hover:bg-white/5 rounded-lg transition-colors group">
                            <span class="text-lg font-black ${index < 3 ? 'text-blue-400' : 'text-slate-600'}">${index + 1}</span>
                            <div class="flex-1 min-w-0">
                                <p class="text-xs font-medium truncate group-hover:text-blue-300">${v.title}</p>
                                <div class="flex justify-between mt-1">
                                    <span class="text-[10px] text-slate-500">${v.author}</span>
                                    <span class="text-[10px] font-bold text-emerald-500">${v.ai_meta_score.toFixed(2)}</span>
                                </div>
                            </div>
                        </a>
                    `;
                });

            } catch (error) {
                console.error("API Connection Error:", error);
                document.getElementById('status-dot').innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span> API è¿æ¥æ–­å¼€';
            }
        }

        updateDashboard();
        setInterval(updateDashboard, 30000); // 30ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®
    </script>
</body>
</html>
